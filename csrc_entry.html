<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>HTML Inputs</title>
  </head>
  
  <body>    
    <h1>The Redirect URL 帶回來的參數: <p id="locationSearch"></p></h1>
    <h2>解析出來的code: <p id="wechat_verify_code"></p></h1>

    <script type="text/javascript">
        
        var redirectParas = '';
        var code = '';

        //location.search = '?code=12345678&state=';
       
        if(location.search !== null && location.search !== undefined) {
            document.getElementById("locationSearch").innerHTML=location.search;
            redirectParas =location.search;

            if(redirectParas.indexOf('=') !== -1 &&  redirectParas.indexOf('&') !== -1 && 
                (redirectParas.indexOf('&') > redirectParas.indexOf('=')) ) {

                  code = redirectParas.substring(redirectParas.indexOf('=') + 1,redirectParas.indexOf('&')) ;
                  document.getElementById("wechat_verify_code").innerHTML = code;
            }

            if(code !== undefined && code !== null && code !== '') {
              ajaxCallWeChatAPIAndGetUser(code);
              
            }
        }
        
        function ajaxCallWeChatAPIAndGetUser(code) {
          console.log('call ajaxCallWeChatAPIAndGetUser:' + code);
        }
       
        // document.getElementById("locationSearch").innerHTML = '?code=12345678&state=';
        // redirectParas = '?code=12345678&state=';        
        

        

    </script>

   
  </body>
</html>